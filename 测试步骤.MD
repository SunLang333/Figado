好的，这是一个针对 Figado 项目前后端主要功能的测试步骤草案：

# Figado 项目功能测试步骤

## 1. 环境准备

1.  **后端服务**: 确保 Django 后端服务已启动并在本地运行 (例如 `http://localhost:8000`)。
2.  **前端服务**: 确保 Vue.js 前端开发服务已启动并在本地运行 (例如 `http://localhost:5173`)，或者已构建的前端静态文件被正确托管。
3.  **测试数据**:
    - 准备至少 2 个有效的 EPUB 格式电子书文件。
    - 准备至少 2 张封面图片 (JPG/PNG)。
    - 准备几组测试用户信息 (用户名、邮箱、密码)。
4.  **测试工具**:
    - 浏览器 (Chrome, Firefox 等)。
    - API 测试工具 (如 Postman, Insomnia) 用于后端接口测试。
5.  **网络**: 确保测试环境网络通畅。

## 2. 后端 API 测试 (使用 API 测试工具)

基础 URL: `http://localhost:8000/api`

### 2.1. 用户认证 API (`/auth/`)

1.  **用户注册 (`POST /auth/register/`)**
    - **TC-API-AUTH-001**: 使用全新的用户名、邮箱和有效密码注册。
      - 预期结果: 返回 `201 Created`，响应体包含用户信息 (不含密码)。
    - **TC-API-AUTH-002**: 使用已存在的用户名注册。
      - 预期结果: 返回 `400 Bad Request`，包含错误信息提示用户名已存在。
    - **TC-API-AUTH-003**: 注册时密码少于 8 个字符。
      - 预期结果: 返回 `400 Bad Request`，包含密码长度相关的错误信息。
    - **TC-API-AUTH-004**: 注册时不提供 `username` 或 `password`。
      - 预期结果: 返回 `400 Bad Request`，提示必填字段缺失。
2.  **用户登录 (`POST /auth/login/`)**
    - **TC-API-AUTH-005**: 使用上一步成功注册的用户的凭据登录。
      - 预期结果: 返回 `200 OK`，响应体包含 `access` 和 `refresh` tokens 及用户信息。记录这些 tokens。
    - **TC-API-AUTH-006**: 使用错误的密码登录。
      - 预期结果: 返回 `401 Unauthorized` 或 `400 Bad Request`，提示凭据无效。
3.  **Token 刷新 (`POST /auth/token/refresh/`)**
    - **TC-API-AUTH-007**: 使用上一步获取的有效 `refresh` token 请求新的 `access` token。
      - 请求体: `{"refresh": "your_refresh_token"}`
      - 预期结果: 返回 `200 OK`，响应体包含新的 `access` token。
    - **TC-API-AUTH-008**: 使用无效或过期的 `refresh` token。
      - 预期结果: 返回 `401 Unauthorized`。
4.  **用户个人资料 (`GET /auth/profile/`, `PUT /auth/profile/`)**
    - **TC-API-AUTH-009**: (需认证) 使用有效的 `access` token 获取当前用户信息。
      - Header: `Authorization: Bearer your_access_token`
      - 预期结果: 返回 `200 OK`，包含当前登录用户的详细信息。
    - **TC-API-AUTH-010**: (需认证) 使用有效的 `access` token 更新用户信息 (例如，更新 `languages` 字段)。
      - Header: `Authorization: Bearer your_access_token`
      - 请求体: `{"languages": ["en", "fr"]}`
      - 预期结果: 返回 `200 OK`，响应体包含更新后的用户信息。
    - **TC-API-AUTH-011**: 不带 `access` token 访问个人资料接口。
      - 预期结果: 返回 `401 Unauthorized`。

### 2.2. 书籍管理 API (`/books/`)

(以下操作均需在 Header 中提供有效的 `Authorization: Bearer your_access_token`)

1.  **创建书籍 (`POST /books/`)**
    - **TC-API-BOOK-001**: 上传一本有效的 EPUB 书籍和一张封面图片，并填写所有必填元数据 (title, author, category, language 等)。
      - 请求类型: `multipart/form-data`
      - 预期结果: 返回 `201 Created`，响应体包含新创建书籍的详细信息。数据库中应有记录，`media` 目录下应有对应文件。
    - **TC-API-BOOK-002**: 上传一个非 EPUB 文件作为书籍文件。
      - 预期结果: 返回 `400 Bad Request`，提示文件类型错误 (基于 `validate_book_file` 逻辑)。
    - **TC-API-BOOK-003**: 创建书籍时不提供必填字段 `title`。
      - 预期结果: 返回 `400 Bad Request`，提示字段缺失。
2.  **获取书籍列表 (`GET /books/`)**
    - **TC-API-BOOK-004**: 获取书籍列表。
      - 预期结果: 返回 `200 OK`，包含一个书籍对象列表 (公开书籍和用户自己的书)。
    - **TC-API-BOOK-005**: 获取书籍列表并使用 `search` 参数 (例如 `?search=测试书名`)。
      - 预期结果: 返回 `200 OK`，列表只包含匹配搜索词的书籍。
3.  **获取书籍详情 (`GET /books/{id}/`)**
    - **TC-API-BOOK-006**: 获取一本存在的公开书籍的详情 (使用其 `id`)。
      - 预期结果: 返回 `200 OK`，包含该书籍的详细信息。
    - **TC-API-BOOK-007**: (用户 A) 尝试获取另一用户 (用户 B) 的私有书籍详情。
      - 预期结果: 返回 `403 Forbidden` 或 `404 Not Found` (取决于权限实现)。
    - **TC-API-BOOK-008**: 获取一个不存在的书籍 `id`。
      - 预期结果: 返回 `404 Not Found`。
4.  **更新书籍信息 (`PUT /books/{id}/` 或 `PATCH /books/{id}/`)**
    - **TC-API-BOOK-009**: (作为书籍所有者) 更新自己上传书籍的元数据 (例如 `title` 或 `description`)。
      - 预期结果: 返回 `200 OK`，响应体包含更新后的书籍信息。
    - **TC-API-BOOK-010**: (作为书籍所有者) 尝试更新书籍的封面图片。
      - 预期结果: 返回 `200 OK`。
    - **TC-API-BOOK-011**: (非书籍所有者) 尝试更新他人书籍。
      - 预期结果: 返回 `403 Forbidden`。
5.  **删除书籍 (`DELETE /books/{id}/`)**
    - **TC-API-BOOK-012**: (作为书籍所有者) 删除自己上传的一本书籍。
      - 预期结果: 返回 `204 No Content`。数据库记录被删除，`media` 目录下对应文件被删除。
    - **TC-API-BOOK-013**: (非书籍所有者) 尝试删除他人书籍。
      - 预期结果: 返回 `403 Forbidden`。
6.  **下载书籍 (`GET /books/{id}/download/`)**
    - **TC-API-BOOK-014**: (作为书籍所有者或有权访问者) 下载一本有 EPUB 文件的书籍。
      - 预期结果: 返回 `200 OK`，响应为文件流，`Content-Disposition` 指示下载。
    - **TC-API-BOOK-015**: 尝试下载一本没有上传 EPUB 文件或 `id` 不存在的书籍。
      - 预期结果: 返回 `404 Not Found`。

### 2.3. API 文档

1.  **Swagger UI (`GET /api/docs/`)**
    - **TC-API-DOC-001**: 在浏览器中访问 Swagger API 文档页面。
      - 预期结果: 页面成功加载，显示所有定义的 API 端点及其文档。

## 3. 前端 UI 与功能测试 (使用浏览器)

### 3.1. 用户认证流程

1.  **注册页面**
    - **TC-FE-AUTH-001**: 打开浏览器，访问注册页面 (例如 `/register`)。
      - 预期结果: 注册表单正确显示。
    - **TC-FE-AUTH-002**: 输入有效的用户名、邮箱、密码和语言偏好，点击“注册”按钮。
      - 预期结果: 提示注册成功，并自动跳转到登录页面。
    - **TC-FE-AUTH-003**: 输入已存在的用户名，点击“注册”。
      - 预期结果: 页面显示错误提示“用户名已存在”或类似信息。
    - **TC-FE-AUTH-004**: 密码输入框不输入或输入少于 8 位，尝试注册。
      - 预期结果: 页面显示相应的表单验证错误提示。
2.  **登录页面**
    - **TC-FE-AUTH-005**: 访问登录页面 (例如 `/login`)。
      - 预期结果: 登录表单正确显示。
    - **TC-FE-AUTH-006**: 使用上一步成功注册的账户信息登录。
      - 预期结果: 登录成功，页面跳转到用户个人资料页 (`/profile`) 或书籍列表页 (`/books`)。导航栏应显示用户已登录状态。`localStorage` 中应存储 `access` token。
    - **TC-FE-AUTH-007**: 使用错误的密码登录。
      - 预期结果: 页面显示错误提示“用户名或密码错误”或类似信息。
3.  **个人资料页面**
    - **TC-FE-AUTH-008**: 登录后，访问个人资料页面 (例如 `/profile`)。
      - 预期结果: 页面正确显示当前用户的用户名、邮箱 (如果后端返回) 和语言偏好。
    - **TC-FE-AUTH-009**: 在个人资料页面，尝试修改语言偏好并保存。
      - 预期结果: 提示保存成功，页面显示更新后的语言偏好。刷新页面后，修改应持久化。
4.  **登出**
    - **TC-FE-AUTH-010**: 在已登录状态下，点击导航栏中的“退出”或“登出”按钮。
      - 预期结果: 用户成功登出，页面跳转到登录页面。导航栏状态更新为未登录。`localStorage` 中的 token 应被清除。

### 3.2. 书籍管理流程

1.  **书籍列表页 (例如 `/books` 或首页)**
    - **TC-FE-BOOK-001**: (登录后) 访问书籍列表页。
      - 预期结果: 页面显示书籍列表，每本书以卡片形式展示封面、标题、作者等信息。
    - **TC-FE-BOOK-002**: 在搜索框中输入一个已知存在的书名或作者的一部分，执行搜索。
      - 预期结果: 书籍列表动态更新，只显示匹配搜索条件的书籍。
    - **TC-FE-BOOK-003**: 点击任意一本书籍卡片。
      - 预期结果: 页面跳转到该书籍的详情页面 (`/book/{id}`)。
2.  **添加新书 (例如通过 `/addBook` 页面或模态框)**
    - **TC-FE-BOOK-004**: (登录后) 导航到添加新书的表单。
      - 预期结果: 添加书籍的表单正确显示。
    - **TC-FE-BOOK-005**: 在表单中填写所有必填信息，选择一个有效的 EPUB 文件。
      - 预期结果: EPUB 文件被选中后，表单中的书名、作者等字段应尝试从 EPUB 元数据自动填充。
    - **TC-FE-BOOK-006**: 选择一张封面图片。
      - 预期结果: 封面图片预览正确显示。
    - **TC-FE-BOOK-007**: 提交表单。
      - 预期结果: 提示书籍添加成功。在书籍列表页应能看到新添加的书籍。
    - **TC-FE-BOOK-008**: 尝试不上传 EPUB 文件或不填写必填项 (如书名) 就提交。
      - 预期结果: 表单显示相应的验证错误提示。
3.  **书籍详情页 (例如 `/book/{id}`)**
    - **TC-FE-BOOK-009**: (登录后) 访问一本已添加书籍的详情页。
      - 预期结果: 页面正确显示该书的封面、标题、作者、描述等详细信息。
    - **TC-FE-BOOK-010**: 点击“在线阅读”按钮。
      - 预期结果: EPUB 阅读器模态框或新页面加载，并显示书籍内容。
      - **TC-FE-BOOK-010a**: 验证目录 (TOC) 功能：目录能正确显示，点击目录项能跳转到对应章节。
      - **TC-FE-BOOK-010b**: 验证翻页功能：点击“上一页”、“下一页”能正确翻页。
    - **TC-FE-BOOK-011**: 点击“下载 EPUB”按钮。
      - 预期结果: 浏览器开始下载该书籍的 EPUB 文件。
4.  **编辑与删除书籍 (通常在个人资料页或书籍详情页，针对书籍所有者)**
    - **TC-FE-BOOK-012**: (作为书籍所有者) 找到自己上传书籍的编辑入口，修改书籍的标题或描述，并保存。
      - 预期结果: 提示修改成功。书籍详情页和列表页应显示更新后的信息。
    - **TC-FE-BOOK-013**: (作为书籍所有者) 找到自己上传书籍的删除入口，确认删除。
      - 预期结果: 提示删除成功。该书籍应从用户的书籍列表和所有公开列表（如果之前是公开的）中移除。

### 3.3. 导航与布局

1.  **TC-FE-NAV-001**: 检查导航栏上的主要链接 (如 Logo、书籍列表、个人中心、登录/注册) 是否都存在且能正确跳转。
2.  **TC-FE-NAV-002**: 验证在登录和未登录状态下，导航栏显示的菜单项是否不同 (例如，未登录显示“登录/注册”，登录后显示“个人中心/退出”)。
3.  **TC-FE-LAYOUT-001**: (简单验证) 调整浏览器窗口大小，观察主要页面 (列表页、详情页) 布局是否能基本适应，没有明显的元素重叠或溢出。

### 3.4. 错误处理与用户提示

1.  **TC-FE-ERR-001**: 在执行需要网络请求的操作时 (如登录、加载书籍)，临时断开后端服务或模拟网络中断。
    - 预期结果: 前端应显示用户友好的网络错误提示，而不是崩溃或无响应。
2.  **TC-FE-ERR-002**: 尝试执行一个已知会失败的操作 (例如，用错误的格式填写表单并提交)。
    - 预期结果: 页面应给出清晰的错误提示信息。

## 4. 移动应用 (Android APK) 测试 (如果已打包)

(基于文档中 Capacitor 打包信息，进行基本验证)

1.  **安装与启动**
    - **TC-APK-GEN-001**: 在 Android 设备或模拟器上成功安装 Figado APK 文件。
    - **TC-APK-GEN-002**: 点击应用图标，成功启动应用。
2.  **核心功能在移动端上的表现**
    - **TC-APK-AUTH-001**: 测试用户注册和登录流程是否顺畅。输入框、按钮是否易于操作。
    - **TC-APK-BOOK-001**: 测试书籍列表的浏览，滑动是否流畅，卡片信息是否清晰。
    - **TC-APK-BOOK-002**: 测试搜索功能在移动端的使用。
    - **TC-APK-BOOK-003**: 测试添加书籍功能：
      - 文件选择器是否能正常工作以选择 EPUB 文件。
      - 如果实现了通过相机或相册选择封面图片 (`mobileService` 相关功能)，验证其可用性。
    - **TC-APK-BOOK-004**: 测试 EPUB 在线阅读体验，包括目录导航和翻页在触摸屏上的操作。
    - **TC-APK-LAYOUT-001**: 检查应用在不同尺寸 Android 设备上的基本布局适应性。

---

**注意**:

- 以上步骤是基于项目文档和通用实践的草案，具体测试时可能需要根据实际实现细节进行调整。
- 每个测试用例 (TC) 都应记录实际结果，并与预期结果进行比较。
- 对于失败的测试用例，应记录详细的复现步骤、错误信息和截图，以便开发人员定位和修复问题。
